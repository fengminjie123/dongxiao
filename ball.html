<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script src="https://cdn.staticfile.org/vue/2.2.2/vue.min.js"></script>
</head>

<body>
    <div id="app">
        <template>
            <div ref="box" class="box" @click="aa">
                <div v-for="item in ballList" class="ball"
                    :style="{ left: item.left + 'px', top: item.top + 'px', width: item.r + 'px', height: item.r + 'px', background: item.color }" />
            </div>
        </template>
    </div>

    <script>
        var app = new Vue({
            el: '#app',   // 选择器
            data: {
                ballList: [],
                VxList: [2, -2],
                VyList: [2, -2],
                rList: [30, 35, 40, 45, 50, 55, 60],
                clientWidth: document.documentElement.clientWidth,
                clientHeight: document.documentElement.clientHeight
            },
            watch: {
                /* 监听*/
                clientHeight(val) {
                    this.ballList.forEach(item => {
                        item.maxHeight = document.documentElement.clientHeight - item.r
                    })
                },
                clientWidth(val) {
                    this.ballList.forEach(item => {
                        item.maxWidth = document.documentElement.clientWidth - item.r
                    })
                }
            },
            mounted() {
                setInterval(this.move, 1000 / 60)
                window.onresize = () => {   //屏幕尺寸变化就重新赋值
                    return (() => {
                        this.clientHeight = document.documentElement.clientHeight
                        this.clientWidth = document.documentElement.clientWidth
                    })()
                }
            },
            methods: {
                aa(e) {
                    let r = this.rList[Math.floor(Math.random()*this.rList.length)]
                    let Vx = this.VxList[Math.floor(Math.random()*this.VxList.length)]
                    let Vy = this.VyList[Math.floor(Math.random()*this.VyList.length)]
                    let maxHeight = document.documentElement.clientHeight - r
                    let maxWidth = document.documentElement.clientWidth - r
                    let R = Math.floor(Math.random()*256)
                    let G = Math.floor(Math.random()*256)
                    let B = Math.floor(Math.random()*256)
                    this.ballList.push({
                        left: this.ee(e.offsetX, 1, e.offsetY, maxWidth, maxHeight, r),
                        top: this.ee(e.offsetX, 2, e.offsetY, maxWidth, maxHeight, r),
                        r: r,
                        newR: r,
                        flag: false,
                        maxHeight: maxHeight,
                        maxWidth: maxWidth,
                        Vx: Vx,
                        Vy: Vy,
                        color: `rgb(${ R }, ${ G }, ${ B })`
                    })
                    this.ballList.forEach(item => {
                        item.maxHeight = document.documentElement.clientHeight - item.r
                        item.maxWidth = document.documentElement.clientWidth - item.r
                    });
                },
                ee(x, type, y, maxWidth, maxHeight, r) {
                    if (type == 1) {
                        if (x <= r / 2) {
                            return 0
                        } else if (x >= maxWidth - r / 2) {
                            return maxWidth - r / 2
                        } else if (x > r / 2 && x < maxWidth - r / 2) {
                            return x - r / 2
                        }
                    }
                    if (type == 2) {
                        if (y <= r / 2) {
                            return 0
                        } else if (y >= maxHeight - r / 2) {
                            return maxHeight - r / 2
                        } else if (y > r / 2 && y < maxHeight - r / 2) {
                            return y - r / 2
                        }
                    }
                },
                move() {
                    if (JSON.stringify(this.ballList) == '[]' || !this.ballList) return
                    this.ballList.forEach(item => {
                        item.left += item.Vx
                        item.top += item.Vy
                        if (item.left > item.maxWidth) { // 右边界
                            item.left = item.maxWidth
                            item.Vx = -item.Vx
                        } else if (item.left < 0) { //左边界
                            item.left = 0
                            item.Vx = -item.Vx
                        } else if (item.top > item.maxHeight) { // 下边界
                            item.top = item.maxHeight
                            item.Vy = -item.Vy
                        } else if (item.top < 0) {
                            item.top = 0
                            item.Vy = -item.Vy
                        }
                    })
                    for(let i = 0; i < this.ballList.length - 1; i++) {
                        for(let j = 1; j < this.ballList.length; j ++) {
                            let d =  Math.sqrt( (this.ballList[i].left - this.ballList[j].left) * (this.ballList[i].left - this.ballList[j].left) + (this.ballList[i].top - this.ballList[j].top) * (this.ballList[i].top - this.ballList[j].top) )
                            if( this.ballList[i].r / 2 > this.ballList[j].r / 2 ) {
                                if(d >= 0 && d <= this.ballList[i].r / 2 - this.ballList[j].r / 2) {
                                    this.ballList[i].newR = this.ballList[j].r * 0.05 + this.ballList[i].r
                                    this.ballList[j].flag = true
                                }
                            }
                            if( this.ballList[i].r / 2 < this.ballList[j].r / 2 ) {
                                if(d >= 0 && d <= this.ballList[j].r / 2 - this.ballList[i].r / 2) {
                                    this.ballList[j].newR = this.ballList[i].r * 0.05 + this.ballList[j].r
                                    this.ballList[i].flag = true
                                }
                            }
                        }
                    }
                    this.ballList.forEach((item, index) => {
                        if(item.flag) {
                            this.ballList.splice(index, 1)
                        }
                        item.r = item.newR
                        item.maxHeight = document.documentElement.clientHeight - item.r
                        item.maxWidth = document.documentElement.clientWidth - item.r
                    })
                }
            }
        })
    </script>
</body>
<style>
    body {
        margin: 0px !important;
    }

    .box {
        width: 100%;
        height: 100%;
    }

    .ball {
        position: absolute;
        background-color: black;
        border-radius: 50%;
        opacity: 0.3;
    }

    #app {
        width: 100%;
        height: 100%;
    }

    body {
        width: 100vw;
        height: 100vh;
    }
</style>

</html>